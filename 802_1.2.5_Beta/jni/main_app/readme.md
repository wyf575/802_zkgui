
## 2021.08.03
echo dumpfb 0 /vendor/udisk_sda1 1 0 0 > /proc/mi_modules/mi_vdec/mi_vdec0 //未开旋转
echo dumpfb 0 /mnt 1 0 1 > /proc/mi_modules/mi_vdec/mi_vdec0 //开旋转

新需求：
1、添加默认视频

2、解决R S 116版本中无图片任务时 重启时只有声音无图像
3、连续上架任务时，视频任务闪现
4、播放视频时开启视图，结束播放关闭视图
5、开机后直接播放本地已经下载的广告任务
6、上下架任务时 客户无感


问题现象：播放视频一闪而过 紧接着播放图片 而视频声音仍然存在 说明视频在后台播放
现象复现：连续上架多个任务且必须是图片和视频混播的情况下就可以复现，只连续上架图片或视频任务不会出现该问题
问题分析：图片任务是带有阻塞的，而视频任务没有，因此在任务队列中只要积累超过两个任务，则播放视频时会立即切换到下一个任务
解决方案：任选一个
    1、把视频任务也做成阻塞的
    2、视频图层放在图片图层之上


已经解决的问题：
1、修复上报MCU版本号不规范的问题
2、将缺省图片播放方式也改为轮播，以便尽快响应新任务
3、修复下架所有任务后设备端无法上架新任务的问题


# 116版本测试项

## 参数组/广告任务同步

1. 上架任务超过10个：是否溢出导致应用挂掉
2. 设备在线时下架任务：是否有删除日志且本地已经删除
3. 上架内存超过50M：设备是否拒绝下载且上报失败
4. 本地存在非法文件是否会自动删除
5. 过期视频是否还会在HTTP的API中给出：不会给出 但是会通过MQTT通知
6. 播放过程中发现过期视频是否会自动删除且上报日志
7. 参数组是否实时更新并响应到设备
8. 已经存在的任务和视频在重启后是否重新拉取(浪费流量)
    8.1 如果有上下架操作就会
    8.2 解决JSON文件受损 会导致 每次启动都重新下载 解决办法：发现解析出错时直接删掉该文件 根本原因是：sync的问题
    

## 播放任务策略

1. 插上U盘后是否优先播放U盘视频：从非U盘模式切换到U盘模式
2. U盘中的文件是否过滤：没有合法文件，是否能自动切换到其他模式
3. RAM模式下，图片和视频混播是否正常
    3.1 注意：由于图片播放采用线程sleep方式来设定时长，因此会出现无法及时响应上下架操作
    3.2 在本地已经存在的任务 需要修改RAM和JSON文件中的播放时间和图片轮播时间(由于平台可以随时更改这些参数 而其他参数只能删除重建)
    3.3 发现问题：如果上下架操作的时候 正在播放图片 会导致新的请求与旧请求产生混乱：图音不符
        3.3.1 需要更改该策略：视频轮播策略是根据其回调完成的，而图片播放完全靠图片播放线程里的sleep完成
        3.3.2 将图片播放和到视频播放调用的同一个线程中
        3.3.3 把图片播放从线程改为阻塞操作
        3.3.4 停止图片播放就直接让UI不显示图片即可

4. 播放过程中是否精准到秒级别播放
5. 任务中的可修改参数是否实时生效
6. 缺省视频播放
7. 缺省图片播放

## 用户APP测试

1. 刀头设备功能测试
2. 货道设备功能测试

## 其他系统优化

1. /config/fbdev.ini 中增大FB_BUFFER_LEN为10240用于图片背景
2. mma需要继续增大(sz=0x3800000)暂时未做





